<html>
    <head>
        <title>Validation Framework</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">

				    <ul class="star">
<li> Overview</li>
<li> <a href="Building a Validator.html">Building a Validator</a></li>
<li> <a href="Expression Validators.html">Expression Validators</a></li>
<li> <a href="Visitor Field Validators.html">Visitor Field Validators</a></li>
<li> <a href="Generic Object Validation.html">Generic Object Validation</a></li>
</ul><p class="paragraph"><h2 class="heading2"> Overview</h2></p>The validation framework in XWork is designed to help you apply simple validation rules to your Actions before they are executed. <p class="paragraph">At its core, the framework takes just about any object and a String context name for which to validate that object. This allows you to have different validation rules for the same class in different contexts. You can define default validation rules in the class-level validation file (<b class="strong">ClassName-validation.xml</b>), and then define validation rules which are added on top of these for a specific context (<b class="strong">ClassName-contextName-validation.xml</b>).  The validation rules are applied in the order they are listed in the validation files and error messages are saved into the Object (if it implements ValidationAware).</p>In the case of Action validation, which is what most XWork users will be doing, the class name is the Action class name and the context is the Action alias.

<p class="paragraph"><h2 class="heading2"> Registering Validators</h2></p>Validation rules are handled by validators, which must be registered with the ValidatorFactory. This may either be done programmatically, using the registerValidator(String name, Class clazz) static method of the ValidatorFactory, or by adding a file named <b class="strong">validators.xml</b> to the root of the classpath that contains this information.  The syntax for <b class="strong">validators.xml</b> is:

<div class="code"><pre>&lt;validators&gt;&#10;    &lt;validator name=&quot;required&quot; class=&quot;com.opensymphony.xwork.validator.validators.RequiredFieldValidator&quot;/&gt;&#10;    &lt;validator name=&quot;requiredstring&quot; class=&quot;com.opensymphony.xwork.validator.validators.RequiredStringValidator&quot;/&gt;&#10;    &lt;validator name=&quot;int&quot; class=&quot;com.opensymphony.xwork.validator.validators.IntRangeFieldValidator&quot;/&gt;&#10;    &lt;validator name=&quot;date&quot; class=&quot;com.opensymphony.xwork.validator.validators.DateRangeFieldValidator&quot;/&gt;&#10;    &lt;validator name=&quot;expression&quot; class=&quot;com.opensymphony.xwork.validator.validators.ExpressionValidator&quot;/&gt;&#10;    &lt;validator name=&quot;fieldexpression&quot; class=&quot;com.opensymphony.xwork.validator.validators.FieldExpressionValidator&quot;/&gt;&#10;    &lt;validator name=&quot;email&quot; class=&quot;com.opensymphony.xwork.validator.validators.EmailValidator&quot;/&gt;&#10;    &lt;validator name=&quot;url&quot; class=&quot;com.opensymphony.xwork.validator.validators.URLValidator&quot;/&gt;&#10;    &lt;validator name=&quot;visitor&quot; class=&quot;com.opensymphony.xwork.validator.validators.VisitorFieldValidator&quot;/&gt;&#10;    &lt;validator name=&quot;conversion&quot; class=&quot;com.opensymphony.xwork.validator.validators.ConversionErrorFieldValidator&quot;/&gt;&#10;&lt;/validators&gt;</pre></div>

<p class="paragraph"><h2 class="heading2"> Turning on Validation</h2></p>The process of applying validation rules to an Action before it is executed is handled by the ValidationInterceptor.  As such, all that is required to enable validation for an Action is to declare the ValidationInterceptor in your XWork config file and add an interceptor-ref to it for your Action.  See <a href="Configuration.html">XW:Configuration</a> for details on how to construct your XWork config file.  Here&#039;s a simple example:

<div class="code"><pre>&lt;xwork&gt;&#10;    &lt;package name=&quot;example&quot;&gt;&#10;        &lt;interceptors&gt;&#10;            &lt;interceptor name=&quot;validator&quot; class=&quot;com.opensymphony.xwork.validator.ValidationInterceptor&quot;/&gt;&#10;        &lt;/interceptors&gt;&#10;&#10;        &lt;action name=&quot;Foo&quot; class=&quot;com.opensymphony.xwork.SimpleAction&quot;&gt;&#10;            &lt;param name=&quot;foo&quot;&gt;17&lt;/param&gt;&#10;            &lt;param name=&quot;bar&quot;&gt;23&lt;/param&gt;&#10;            &lt;result name=&quot;success&quot; type=&quot;chain&quot;&gt;&#10;                &lt;param name=&quot;actionName&quot;&gt;Bar&lt;/param&gt;&#10;            &lt;/result&gt;&#10;            &lt;interceptor&#45;ref name=&quot;validator&quot;/&gt;&#10;        &lt;/action&gt;&#10;    &lt;/package&gt;&#10;&lt;xwork&gt;</pre></div><p class="paragraph">Bear in mind that the ValidationInterceptor only performs validation.  The Action will still be executed even if there are any validation errors.</p><h2 class="heading2"> Defining Validation Rules</h2><p class="paragraph">To define validation rules for an Action, create a file named <b class="strong">ActionName-validation.xml</b> in the same package as the Action. You may also create alias-specific validation rules which add to the default validation rules defined in <b class="strong">ActionName-validation.xml</b> by creating another file in the same directory named <b class="strong">ActionName-aliasName-validation.xml</b>.  In both cases,  <em class="emphasis">ActionName</em> is the name of the Action class, and <em class="emphasis">aliasName</em> is the name of the Action alias defined in the <b class="strong">xwork.xml</b> configuration for the Action.</p>The framework will also search up the inheritance tree of the Action to find validation rules for interfaces and parent classes of the Action.  This is particularly powerful when combined with ModelDriven Actions and the <a href="Visitor Field Validators.html">VisitorFieldValidator</a>.  Here&#039;s an example of how validation rules are discovered.  Given the following class structure:
<ul class="star">
<li> interface Animal;</li>
<li> interface Quadraped extends Animal;</li>
<li> class AnimalImpl implements Animal;</li>
<li> class QuadrapedImpl extends AnimalImpl implements Quadraped;</li>
<li> class Dog extends QuadrapedImpl;</li>
</ul><br/>
The framework method will look for the following config files if Dog is to be validated:
<ol>
<li> Animal</li>
<li> Animal-aliasname</li>
<li> AnimalImpl</li>
<li> AnimalImpl-aliasname</li>
<li> Quadraped</li>
<li> Quadraped-aliasname</li>
<li> QuadrapedImpl</li>
<li> QuadrapedImpl-aliasname</li>
<li> Dog</li>
<li> Dog-aliasname</li>
</ol><p class="paragraph">While this process is similar to what the <a href="Localization.html">XW:Localization</a> framework does when finding messages, there are some subtle differences.  The most important difference is that validation rules are discovered from the parent downwards.</p><h3 class="heading3">  Syntax for Validation Rules</h3><p class="paragraph">Here is a sample config file containing validation rules for SimpleAction from the Xwork test cases:</p><div class="code"><pre>&lt;&#33;DOCTYPE validators PUBLIC &quot;&#45;//OpenSymphony Group//XWork Validator 1.0//EN&quot;&#10;        &quot;http&#58;//www.opensymphony.com/xwork/xwork&#45;validator&#45;1.0.dtd&quot;&gt;&#10;&lt;validators&gt;&#10;    &lt;field name=&quot;bar&quot;&gt;&#10;        &lt;field&#45;validator type=&quot;required&quot;&gt;&#10;            &lt;message&gt;You must enter a value for bar.&lt;/message&gt;&#10;        &lt;/field&#45;validator&gt;&#10;        &lt;field&#45;validator type=&quot;int&quot;&gt;&#10;            &lt;param name=&quot;min&quot;&gt;6&lt;/param&gt;&#10;            &lt;param name=&quot;max&quot;&gt;10&lt;/param&gt;&#10;            &lt;message&gt;bar must be between $&#123;min&#125; and $&#123;max&#125;, current value is $&#123;bar&#125;.&lt;/message&gt;&#10;        &lt;/field&#45;validator&gt;&#10;    &lt;/field&gt;&#10;    &lt;field name=&quot;date&quot;&gt;&#10;        &lt;field&#45;validator type=&quot;date&quot;&gt;&#10;            &lt;param name=&quot;min&quot;&gt;12/22/2002&lt;/param&gt;&#10;            &lt;param name=&quot;max&quot;&gt;12/25/2002&lt;/param&gt;&#10;            &lt;message&gt;The date must be between 12&#45;22&#45;2002 and 12&#45;25&#45;2002.&lt;/message&gt;&#10;        &lt;/field&#45;validator&gt;&#10;    &lt;/field&gt;&#10;    &lt;field name=&quot;foo&quot;&gt;&#10;        &lt;field&#45;validator type=&quot;int&quot;&gt;&#10;            &lt;param name=&quot;min&quot;&gt;0&lt;/param&gt;&#10;            &lt;param name=&quot;max&quot;&gt;100&lt;/param&gt;&#10;            &lt;message key=&quot;foo.range&quot;&gt;Could not find foo.range&#33;&lt;/message&gt;&#10;        &lt;/field&#45;validator&gt;&#10;    &lt;/field&gt;&#10;    &lt;validator type=&quot;expression&quot;&gt;&#10;        &lt;param name=&quot;expression&quot;&gt;foo &gt; bar&lt;/param&gt;&#10;        &lt;message&gt;Foo must be greater than Bar. Foo = $&#123;foo&#125;, Bar = $&#123;bar&#125;.&lt;/message&gt;&#10;    &lt;/validator&gt;&#10;&lt;/validators&gt;</pre></div><p class="paragraph">All &lt;validator&gt; (and &lt;field-validator&gt;) elements must have a &quot;type&quot; attribute, which refers to a name of a Validator registered with the ValidatorFactory as described above.  These elements may also have &lt;param&gt; elements with name and value attributes to set arbitrary parameters into the Validator instance.</p>All &lt;validator&gt; (and &lt;field-validator&gt;) elements must also define one <b class="strong">message</b> subelement, which defines the message that should be added to the Action if the validator fails.  By default, the message will be that contained in the body of the message tag.  The <b class="strong">message</b> element also has one optional attribute, &quot;key,&quot; which specifies a message key to look up in the Action&#039;s ResourceBundles using getText() from LocaleAware if the Action implements that interface (as ActionSupport does). This provides for Localized messages based on the Locale of the user making the request (or whatever Locale you&#039;ve set into the LocaleAware Action).<p class="paragraph">If the validator fails, the validator is pushed onto the ValueStack and the message &#8211; either the default or the locale-specific one if the &quot;key&quot; attribute is defined (and such a message exists) &#8211; is parsed for \$&#123;...&#125; sections which are replaced with the evaluated value of the string between the \$&#123; and &#125;. This allows you to parameterize your messages with values from the validator, the Action, or both. Here is an example of a parameterized message:</p><div class="code"><pre>bar must be between &#92;$&#123;min&#125; and &#92;$&#123;max&#125;, current value is &#92;$&#123;bar&#125;.</pre></div><p class="paragraph">This will pull the min and max parameters from the IntRangeFieldValidator and the value of bar from the Action.</p><h4 class="heading4"> Validator vs. Field-Validator</h4><p class="paragraph">The &lt;field-validator&gt; elements are basically the same as the &lt;validator&gt; elements except that they inherit the &quot;fieldName&quot; attribute from its enclosing &lt;field&gt; element.  FieldValidators will have their &quot;fieldName&quot; automatically filled with the value of the parent &lt;field&gt; element&#039;s &quot;fieldName&quot; attribute.  The reason for this structure is to clearly group the validators for a particular field under one element, and because the &quot;fieldName&quot; attribute would otherwise always have to be set for all field validators.</p>That said, it&#039;s perfectly legal to only use validator elements without the field elements and set the &quot;fieldName&quot; attribute for each of them.  The following are effectively equal:

<div class="code"><pre>&lt;field name=&quot;bar&quot;&gt;&#10;    &lt;field&#45;validator type=&quot;required&quot;&gt;&#10;        &lt;message&gt;You must enter a value for bar.&lt;/message&gt;&#10;    &lt;/field&#45;validator&gt;&#10;&lt;/field&gt;&#10;&#10;&lt;validator type=&quot;required&quot;&gt;&#10;    &lt;param name=&quot;fieldName&quot;&gt;bar&lt;/param&gt;&#10;    &lt;message&gt;You must enter a value for bar.&lt;/message&gt;&#10;&lt;/validator&gt;</pre></div>
<p class="paragraph"><h3 class="heading3"> Short-circuiting Validators</h3></p>Beginning with WebWork 2.1, it is possible to short-circuit a stack of validators.  Here is another sample config file containing validation rules from the Xwork test cases:

<div class="code"><pre>&lt;&#33;DOCTYPE validators PUBLIC &quot;&#45;//OpenSymphony Group//XWork Validator 1.0//EN&quot; &quot;http&#58;//www.opensymphony.com/xwork/xwork&#45;validator&#45;1.0.dtd&quot;&gt;&#10;&lt;validators&gt;&#10;    &lt;field name=&quot;email&quot;&gt;&#10;        &lt;field&#45;validator type=&quot;required&quot; short&#45;circuit=&quot;true&quot;&gt;&#10;            &lt;message&gt;You must enter a value for email.&lt;/message&gt;&#10;        &lt;/field&#45;validator&gt;&#10;        &lt;field&#45;validator type=&quot;email&quot; short&#45;circuit=&quot;true&quot;&gt;&#10;            &lt;message&gt;Not a valid e&#45;mail.&lt;/message&gt;&#10;        &lt;/field&#45;validator&gt;&#10;    &lt;/field&gt;&#10;    &lt;field name=&quot;email2&quot;&gt;&#10;        &lt;field&#45;validator type=&quot;required&quot;&gt;&#10;            &lt;message&gt;You must enter a value for email2.&lt;/message&gt;&#10;        &lt;/field&#45;validator&gt;&#10;        &lt;field&#45;validator type=&quot;email&quot;&gt;&#10;            &lt;message&gt;Not a valid e&#45;mail2.&lt;/message&gt;&#10;        &lt;/field&#45;validator&gt;&#10;    &lt;/field&gt;&#10;    &lt;validator type=&quot;expression&quot;&gt;&#10;        &lt;param name=&quot;expression&quot;&gt;email.equals(email2)&lt;/param&gt;&#10;        &lt;message&gt;Email not the same as email2&lt;/message&gt;&#10;    &lt;/validator&gt;&#10;    &lt;validator type=&quot;expression&quot; short&#45;circuit=&quot;true&quot;&gt;&#10;        &lt;param name=&quot;expression&quot;&gt;email.startsWith(&#039;mark&#039;)&lt;/param&gt;&#10;        &lt;message&gt;Email does not start with mark&lt;/message&gt;&#10;    &lt;/validator&gt;&#10;&lt;/validators&gt;</pre></div><p class="paragraph">Notice that some of the &lt;field-validator&gt; and &lt;validator&gt; elements have the &quot;short-circuit&quot; attribute set to true.  Since validators are evaluated in the order they are declared, a validator with this attribute set to true will prevent the evaluation of subsequent validators if the validator fails, where failure is determined by the addition of an error (action or field error depending on the type of validator) to the ValidationContext of the object being validated.</p>A field-validator that gets short-circuited will only prevent other field-validators for the same field from being evaluated.  A non field-validator that gets short-circuited will completely break out of the validation stack &#8211; no other validators will be evaluated.<p class="paragraph">As mentioned above,  the framework will also search up the inheritance tree of the action to find default validations for interfaces and parent classes of the Action.  If you are using the &quot;short-circuit&quot; attribute and relying on default validators higher up in the inheritance tree, make sure you don&#039;t accidentally short-circuit things higher in the tree that you really want!</p>

				    
			    </td>
		    </tr>
	    </table>
    </body>
</html>
