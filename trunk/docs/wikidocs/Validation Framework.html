<html>
    <head>
        <title>XWork - 
        Validation Framework
         </title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <ul>
	<li>Overview</li>
	<li><a href="Standard Validators.html" title="Standard Validators">Standard Validators</a> - details on validators bundled with XWork</li>
	<li><a href="ExpressionValidator Tips.html" title="ExpressionValidator Tips">ExpressionValidator Tips</a> - tips for using the ExpressionValidator</li>
	<li><a href="Building a Validator.html" title="Building a Validator">Building a Validator</a> - how to create your own Validator</li>
	<li><a href="Generic Object Validation.html" title="Generic Object Validation">Generic Object Validation</a> - shows how to use the validators to validate any object</li>
	<li><a href="Custom Action Validation.html" title="Custom Action Validation">Custom Action Validation</a> - details how to specify custom validation code for an Action</li>
</ul>




<h2><a name="ValidationFramework-Overview"></a>Overview</h2>

<p>The validation framework in XWork is designed to help you apply simple validation rules to your Actions before they are executed. </p>

<p>At its core, the framework takes just about any object and a String context name for which to validate that object. This allows you to have different validation rules for the same class in different contexts. You can define default validation rules in the class-level validation file (<b>ClassName-validation.xml</b>), and then define validation rules which are added on top of these for a specific context (<b>ClassName-contextName-validation.xml</b>).  The validation rules are applied in the order they are listed in the validation files and error messages are saved into the Object (if it implements ValidationAware).</p>

<p>In the case of Action validation, which is what most XWork users will be doing, the class name is the Action class name and the context is the Action alias.</p>


<h2><a name="ValidationFramework-RegisteringValidators"></a>Registering Validators</h2>

<p>Validation rules are handled by validators, which must be registered with the ValidatorFactory. This may either be done programmatically, using the registerValidator(String name, Class clazz) static method of the ValidatorFactory, or by adding a file named <b>validators.xml</b> to the root of the classpath that contains this information.  The syntax for <b>validators.xml</b> is:</p>

<div class="code"><div class="codeContent">
<pre class="code-xml"><span class="code-tag">&lt;validators&gt;</span>
    &lt;validator name=<span class="code-quote">"required"</span> 
        class=<span class="code-quote">"com.opensymphony.xwork.validator.validators.RequiredFieldValidator"</span>/&gt;
    &lt;validator name=<span class="code-quote">"requiredstring"</span> 
        class=<span class="code-quote">"com.opensymphony.xwork.validator.validators.RequiredStringValidator"</span>/&gt;
    &lt;validator name=<span class="code-quote">"stringlength"</span> 
        class=<span class="code-quote">"com.opensymphony.xwork.validator.validators.StringLengthFieldValidator"</span>/&gt;
    &lt;validator name=<span class="code-quote">"int"</span> 
        class=<span class="code-quote">"com.opensymphony.xwork.validator.validators.IntRangeFieldValidator"</span>/&gt;
    &lt;validator name=<span class="code-quote">"date"</span> 
        class=<span class="code-quote">"com.opensymphony.xwork.validator.validators.DateRangeFieldValidator"</span>/&gt;
    &lt;validator name=<span class="code-quote">"expression"</span>
        class=<span class="code-quote">"com.opensymphony.xwork.validator.validators.ExpressionValidator"</span>/&gt;
    &lt;validator name=<span class="code-quote">"fieldexpression"</span> 
        class=<span class="code-quote">"com.opensymphony.xwork.validator.validators.FieldExpressionValidator"</span>/&gt;
    &lt;validator name=<span class="code-quote">"email"</span> 
        class=<span class="code-quote">"com.opensymphony.xwork.validator.validators.EmailValidator"</span>/&gt;
    &lt;validator name=<span class="code-quote">"url"</span> 
        class=<span class="code-quote">"com.opensymphony.xwork.validator.validators.URLValidator"</span>/&gt;
    &lt;validator name=<span class="code-quote">"visitor"</span> 
        class=<span class="code-quote">"com.opensymphony.xwork.validator.validators.VisitorFieldValidator"</span>/&gt;
    &lt;validator name=<span class="code-quote">"conversion"</span>
        class=<span class="code-quote">"com.opensymphony.xwork.validator.validators.ConversionErrorFieldValidator"</span>/&gt;
    &lt;validator name=<span class="code-quote">"regex"</span> 
        class=<span class="code-quote">"com.opensymphony.xwork.validator.validators.RegexFieldValidator"</span>/&gt;
<span class="code-tag">&lt;/validators&gt;</span></pre>
</div></div>

<table cellpadding='5' width='85%' cellspacing='8px' class='infoMacro' border="0" align='center'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="icons/emoticons/information.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b class="strong">Useful Information</b><br />
<p>validators.xml if being defined should be available in the classpath. However this is not necessary, if no custom validator is needed. Webwork will automatically picked up a predefined sets of validators defined in com/opensymphony/xwork/validator/validators/default.xml packaged together in xwork jar file that comes with webwork distribution. See ValidatorFactory static block for details.</p></td></tr></table>

<table cellpadding='5' width='85%' cellspacing='8px' class='noteMacro' border="0" align='center'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b class="strong">Warning</b><br />
<p>If custom validator is being defined and a validators.xml is created and place in the classpath, do remember to copy all the other pre-defined validators that is needed into the validators.xml as if not they will not be registered. Once a validators.xml is detected in the classpath, the default one (com/opensymphony/xwork/validator/validators/default.xml) will not be loaded. It is only loaded when a custom validators.xml cannot be found in the classpath. Be careful.</p></td></tr></table>


<h2><a name="ValidationFramework-TurningonValidation"></a>Turning on Validation</h2>

<p>The process of applying validation rules to an Action before it is executed is handled by the ValidationInterceptor.  As such, all that is required to enable validation for an Action is to declare the ValidationInterceptor in your XWork config file and add an interceptor-ref to it for your Action.  See <a href="Configuration.html" title="Configuration">XW:Configuration</a> for details on how to construct your XWork config file.  Here's a simple example:</p>

<div class="code"><div class="codeContent">
<pre class="code-xml"><span class="code-tag">&lt;xwork&gt;</span>
    <span class="code-tag">&lt;package name=<span class="code-quote">"example"</span>&gt;</span>
        <span class="code-tag">&lt;interceptors&gt;</span>
            &lt;interceptor name=<span class="code-quote">"validator"</span> 
                class=<span class="code-quote">"com.opensymphony.xwork.validator.ValidationInterceptor"</span>/&gt;
        <span class="code-tag">&lt;/interceptors&gt;</span>

        <span class="code-tag">&lt;action name=<span class="code-quote">"Foo"</span> class=<span class="code-quote">"com.opensymphony.xwork.SimpleAction"</span>&gt;</span>
            <span class="code-tag">&lt;param name=<span class="code-quote">"foo"</span>&gt;</span>17<span class="code-tag">&lt;/param&gt;</span>
            <span class="code-tag">&lt;param name=<span class="code-quote">"bar"</span>&gt;</span>23<span class="code-tag">&lt;/param&gt;</span>
            <span class="code-tag">&lt;result name=<span class="code-quote">"success"</span> type=<span class="code-quote">"chain"</span>&gt;</span>
                <span class="code-tag">&lt;param name=<span class="code-quote">"actionName"</span>&gt;</span>Bar<span class="code-tag">&lt;/param&gt;</span>
            <span class="code-tag">&lt;/result&gt;</span>
            <span class="code-tag">&lt;interceptor-ref name=<span class="code-quote">"validator"</span>/&gt;</span>
        <span class="code-tag">&lt;/action&gt;</span>
    <span class="code-tag">&lt;/package&gt;</span>
<span class="code-tag">&lt;xwork&gt;</span></pre>
</div></div>

<p>Bear in mind that the ValidationInterceptor only performs validation.  The Action will still be executed even if there are any validation errors. It kicks off the validation by delegating task to ActionValidatorManager.</p>


<h2><a name="ValidationFramework-UnderstandingValidatorflavors"></a>Understanding Validator flavors</h2>
<p>The validators supplied by the Xwork distribution (and any validators you might write yourself) come in two different flavors:</p>
<ol>
	<li>Plain Validators</li>
	<li>FieldValidators</li>
</ol>


<p>Plain Validators (such as the ExpressionValidator) perform validation checks that are not inherently tied to a single specified field.  When you declare a plain Validator in your -validation.xml file you do not associate a <em>fieldname</em> attribute with it.  (You should avoid using plain Validators within the &lt;field-validator&gt; syntax described below.)</p>

<p>FieldValidators (such as the EmailValidator) are designed to perform validation checks on a single field.  They require that you specify a <em>fieldname</em> attribute in your -validation.xml file.  There are two different (but equivalent) XML syntaxes you can use to declare FieldValidators (see "&lt;validator&gt; vs. &lt;field-Validator&gt; syntax" below).</p>

<p>There are two places where the differences between the two validator flavors are important to keep in mind:</p>
<ol>
	<li>when choosing the xml syntax used for declaring a validator (either &lt;validator&gt; or &lt;field-validator&gt;)</li>
	<li>when using the short-circuit capability</li>
</ol>


<div class="panel"><div class="panelContent" style="background-color: #ffffce; ">
<p>Note that you do not declare what "flavor" of validator you are using in your -validation.xml file, you just declare the name of the validator to use and WebWork will know whether it's a "plain Validator" or a "FieldValidator" by looking at the validation class that the validator's programmer chose to implement.</p>
</div></div>


<h2><a name="ValidationFramework-DefiningValidationRules"></a>Defining Validation Rules</h2>

<p>To define validation rules for an Action, create a file named <b>ActionName-validation.xml</b> in the same package as the Action. You may also create alias-specific validation rules which add to the default validation rules defined in <b>ActionName-validation.xml</b> by creating another file in the same directory named <b>ActionName-aliasName-validation.xml</b>.  In both cases,  <b>ActionName</b> is the name of the Action class, and <b>aliasName</b> is the name of the Action alias defined in the <b>xwork.xml</b> configuration for the Action. </p>

<p>The framework will also search up the inheritance tree of the Action to find validation rules for directly implemented interfaces and parent classes of the Action.  This is particularly powerful when combined with ModelDriven Actions and the <a href="Standard Validators.html#StandardValidators-VisitorFieldValidator" title="VisitorFieldValidator on Standard Validators">VisitorFieldValidator</a>.  Here's an example of how validation rules are discovered.  Given the following class structure:</p>

<ul>
	<li>interface Animal;</li>
	<li>interface Quadraped extends Animal;</li>
	<li>class AnimalImpl implements Animal;</li>
	<li>class QuadrapedImpl extends AnimalImpl implements Quadraped;</li>
	<li>class Dog extends QuadrapedImpl;</li>
</ul>


<p>The framework method will look for the following config files if Dog is to be validated:</p>

<ol>
	<li>Animal</li>
	<li>Animal-aliasname</li>
	<li>AnimalImpl</li>
	<li>AnimalImpl-aliasname</li>
	<li>Quadraped</li>
	<li>Quadraped-aliasname</li>
	<li>QuadrapedImpl</li>
	<li>QuadrapedImpl-aliasname</li>
	<li>Dog</li>
	<li>Dog-aliasname</li>
</ol>



<p>While this process is similar to what the <a href="Localization.html" title="Localization">XW:Localization</a> framework does when finding messages, there are some subtle differences.  The most important difference is that validation rules are discovered from the parent downwards.</p>

<table cellpadding='5' width='85%' cellspacing='8px' class='noteMacro' border="0" align='center'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="icons/emoticons/warning.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b class="strong">Take Note</b><br />
<p>Child's *-validation.xml will override parent's *-validation.xml according to the class hierarchi defined above.</p></td></tr></table>


<h3><a name="ValidationFramework-SyntaxforValidationRules"></a>Syntax for Validation Rules</h3>

<p>Here is a sample config file containing validation rules for SimpleAction from the Xwork test cases:</p>

<div class="code"><div class="codeContent">
<pre class="code-xml">&lt;!DOCTYPE validators PUBLIC <span class="code-quote">"-//OpenSymphony Group//XWork Validator 1.0.2//EN"</span> 
<span class="code-quote">"http://www.opensymphony.com/xwork/xwork-validator-1.0.2.dtd"</span>&gt;
<span class="code-tag">&lt;validators&gt;</span>
    <span class="code-tag">&lt;field name=<span class="code-quote">"bar"</span>&gt;</span>
        <span class="code-tag">&lt;field-validator type=<span class="code-quote">"required"</span>&gt;</span>
            <span class="code-tag">&lt;message&gt;</span>You must enter a value for bar.<span class="code-tag">&lt;/message&gt;</span>
        <span class="code-tag">&lt;/field-validator&gt;</span>
        <span class="code-tag">&lt;field-validator type=<span class="code-quote">"int"</span>&gt;</span>
            <span class="code-tag">&lt;param name=<span class="code-quote">"min"</span>&gt;</span>6<span class="code-tag">&lt;/param&gt;</span>
            <span class="code-tag">&lt;param name=<span class="code-quote">"max"</span>&gt;</span>10<span class="code-tag">&lt;/param&gt;</span>
            <span class="code-tag">&lt;message&gt;</span>bar must be between ${min} and ${max}, current value is ${bar}.<span class="code-tag">&lt;/message&gt;</span>
        <span class="code-tag">&lt;/field-validator&gt;</span>
    <span class="code-tag">&lt;/field&gt;</span>
    <span class="code-tag">&lt;field name=<span class="code-quote">"bar2"</span>&gt;</span>
        <span class="code-tag">&lt;field-validator type=<span class="code-quote">"regex"</span>&gt;</span>
            <span class="code-tag">&lt;param name=<span class="code-quote">"regex"</span>&gt;</span>[0-9],[0-9]<span class="code-tag">&lt;/param&gt;</span>
            <span class="code-tag">&lt;message&gt;</span>The value of bar2 must be in the format <span class="code-quote">"x, y"</span>, where x and y are between 0 and 9<span class="code-tag">&lt;/message&gt;</span>
        <span class="code-tag">&lt;/field-validator&gt;</span>
    <span class="code-tag">&lt;/field&gt;</span>
    <span class="code-tag">&lt;field name=<span class="code-quote">"date"</span>&gt;</span>
        <span class="code-tag">&lt;field-validator type=<span class="code-quote">"date"</span>&gt;</span>
            <span class="code-tag">&lt;param name=<span class="code-quote">"min"</span>&gt;</span>12/22/2002<span class="code-tag">&lt;/param&gt;</span>
            <span class="code-tag">&lt;param name=<span class="code-quote">"max"</span>&gt;</span>12/25/2002<span class="code-tag">&lt;/param&gt;</span>
            <span class="code-tag">&lt;message&gt;</span>The date must be between 12-22-2002 and 12-25-2002.<span class="code-tag">&lt;/message&gt;</span>
        <span class="code-tag">&lt;/field-validator&gt;</span>
    <span class="code-tag">&lt;/field&gt;</span>
    <span class="code-tag">&lt;field name=<span class="code-quote">"foo"</span>&gt;</span>
        <span class="code-tag">&lt;field-validator type=<span class="code-quote">"int"</span>&gt;</span>
            <span class="code-tag">&lt;param name=<span class="code-quote">"min"</span>&gt;</span>0<span class="code-tag">&lt;/param&gt;</span>
            <span class="code-tag">&lt;param name=<span class="code-quote">"max"</span>&gt;</span>100<span class="code-tag">&lt;/param&gt;</span>
            <span class="code-tag">&lt;message key=<span class="code-quote">"foo.range"</span>&gt;</span>Could not find foo.range!<span class="code-tag">&lt;/message&gt;</span>
        <span class="code-tag">&lt;/field-validator&gt;</span>
    <span class="code-tag">&lt;/field&gt;</span>
    <span class="code-tag">&lt;validator type=<span class="code-quote">"expression"</span>&gt;</span>
        <span class="code-tag">&lt;param name=<span class="code-quote">"expression"</span>&gt;</span>foo &amp;amp;gt; bar<span class="code-tag">&lt;/param&gt;</span>
        <span class="code-tag">&lt;message&gt;</span>Foo must be greater than Bar. Foo = ${foo}, Bar = ${bar}.<span class="code-tag">&lt;/message&gt;</span>
    <span class="code-tag">&lt;/validator&gt;</span>
<span class="code-tag">&lt;/validators&gt;</span></pre>
</div></div>

<p>All &lt;validator&gt; (and &lt;field-validator&gt;) elements must have a <em>type</em> attribute, which refers to a name of a Validator registered with the ValidatorFactory as described above.  These elements may also have &lt;param&gt; elements with name and value attributes to set arbitrary parameters into the Validator instance. </p>

<p>All &lt;validator&gt; (and &lt;field-validator&gt;) elements must also define one <b>message</b> subelement, which defines the message that should be added to the Action if the validator fails.  By default, the message will be that contained in the body of the message tag.  The <b>message</b> element also has one optional attribute, <em>key</em>, which specifies a message key to look up in the Action's ResourceBundles using getText() from LocaleAware if the Action implements that interface (as ActionSupport does). This provides for Localized messages based on the Locale of the user making the request (or whatever Locale you've set into the LocaleAware Action).  When a <em>key</em> is specified, any text contained in the body of the message tag becomes the default message if a message cannot be found for the given key.</p>

<p>If the validator fails, the validator is pushed onto the ValueStack and the message &#8211; either the default or the locale-specific one if the <em>key</em> attribute is defined (and such a message exists) &#8211; is parsed for ${...} sections which are replaced with the evaluated value of the string between the ${ and }. This allows you to parameterize your messages with values from the validator, the Action, or both. Here is an example of a parameterized message:</p>

<div class="code"><div class="codeContent">
<pre class="code-java">bar must be between $\{min\} and $\{max\}, current value is $\{bar\}.</pre>
</div></div>

<p>This will pull the min and max parameters from the IntRangeFieldValidator and the value of bar from the Action.</p>

<p>A more complete example of the validation rules can be found <a href="Sample Validation Rules.html" title="Sample Validation Rules">here</a>.</p>

<div class="panel"><div class="panelContent" style="background-color: #ffffce; ">
<p><img class="emoticon" src="./icons/emoticons/information.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> Since validation rules are in an XML file, you must make sure you escape special characters.  For example, notice that in the expression validator rule above we use "&amp;gt;" instead of "&gt;".  Consult a resource on XML for the full list of characters that must be escaped.  The most commonly used characters that must be escaped are:  &amp; (use &amp;amp;&#41;,  &gt; (user &amp;gt;&#41;, and &lt; (use &amp;lt;&#41;.</p>
</div></div>


<h3><a name="ValidationFramework-%3Cvalidator%3Evs.%3CfieldValidator%3Esyntax"></a>&lt;validator&gt; vs. &lt;field-Validator&gt; syntax</h3>

<p>There are two ways you can define validators in your -validation.xml file:</p>
<ol>
	<li>&lt;validator&gt;</li>
	<li>&lt;field-validator&gt;</li>
</ol>


<p>Keep the following in mind when using either syntax:</p>

<p><u><b>&lt;validator&gt;</b></u><br/>
The &lt;validator&gt; element allows you to declare both types of validators (either a plain Validator a field-specific FieldValidator).</p>

<p>Declaring a plain Validator using the &lt;validator&gt; syntax:</p>
<div class="code"><div class="codeContent">
<pre class="code-xml"><span class="code-tag">&lt;validator type=<span class="code-quote">"expression"</span>&gt;</span>
    <span class="code-tag">&lt;param name=<span class="code-quote">"expression"</span>&gt;</span>foo gt bar<span class="code-tag">&lt;/param&gt;</span>
    <span class="code-tag">&lt;message&gt;</span>foo must be great than bar.<span class="code-tag">&lt;/message&gt;</span>
<span class="code-tag">&lt;/validator&gt;</span></pre>
</div></div>

<p>Declaring a FieldValidator using the &lt;validator&gt; syntax:</p>
<div class="code"><div class="codeContent">
<pre class="code-xml"><span class="code-tag">&lt;validator type=<span class="code-quote">"required"</span>&gt;</span>
    <span class="code-tag">&lt;param name=<span class="code-quote">"fieldName"</span>&gt;</span>bar<span class="code-tag">&lt;/param&gt;</span>
    <span class="code-tag">&lt;message&gt;</span>You must enter a value for bar.<span class="code-tag">&lt;/message&gt;</span>
<span class="code-tag">&lt;/validator&gt;</span></pre>
</div></div>


<p><u><b>&lt;field-validator&gt;</b></u><br/>
The &lt;field-validator&gt; elements are basically the same as the &lt;validator&gt; elements except that they inherit the <em>fieldName</em> attribute from the enclosing &lt;field&gt; element.  FieldValidators defined within a &lt;field-validator&gt; element will have their <em>fieldName</em> automatically filled with the value of the parent &lt;field&gt; element's <em>fieldName</em> attribute.  The reason for this structure is to conveniently group the validators for a particular field under one element, otherwise the <em>fieldName</em> attribute would have to be repeated, over and over, for each individual &lt;validator&gt;.</p>

<p>Declaring a FieldValidator using the &lt;field-validator&gt; syntax:</p>
<div class="code"><div class="codeContent">
<pre class="code-xml"><span class="code-tag">&lt;field name=<span class="code-quote">"email_address"</span>&gt;</span>
    <span class="code-tag">&lt;field-validator type=<span class="code-quote">"required"</span>&gt;</span>
        <span class="code-tag">&lt;message&gt;</span>You cannot leave the email address field empty.<span class="code-tag">&lt;/message&gt;</span>
    <span class="code-tag">&lt;/field-validator&gt;</span>
    <span class="code-tag">&lt;field-validator type=<span class="code-quote">"email"</span>&gt;</span>
        <span class="code-tag">&lt;message&gt;</span>The email address you entered is not valid.<span class="code-tag">&lt;/message&gt;</span>
    <span class="code-tag">&lt;/field-validator&gt;</span>
<span class="code-tag">&lt;/field&gt;</span></pre>
</div></div>

<p>The choice is yours.  It's perfectly legal to only use &lt;validator&gt; elements without the &lt;field&gt; elements and set the <em>fieldName</em> attribute for each of them.  The following are effectively equal:</p>

<div class="code"><div class="codeContent">
<pre class="code-xml"><span class="code-tag">&lt;field name=<span class="code-quote">"email_address"</span>&gt;</span>
    <span class="code-tag">&lt;field-validator type=<span class="code-quote">"required"</span>&gt;</span>
        <span class="code-tag">&lt;message&gt;</span>You cannot leave the email address field empty.<span class="code-tag">&lt;/message&gt;</span>
    <span class="code-tag">&lt;/field-validator&gt;</span>
    <span class="code-tag">&lt;field-validator type=<span class="code-quote">"email"</span>&gt;</span>
        <span class="code-tag">&lt;message&gt;</span>The email address you entered is not valid.<span class="code-tag">&lt;/message&gt;</span>
    <span class="code-tag">&lt;/field-validator&gt;</span>
<span class="code-tag">&lt;/field&gt;</span>


<span class="code-tag">&lt;validator type=<span class="code-quote">"required"</span>&gt;</span>
    <span class="code-tag">&lt;param name=<span class="code-quote">"fieldName"</span>&gt;</span>email_address<span class="code-tag">&lt;/param&gt;</span>
    <span class="code-tag">&lt;message&gt;</span>You cannot leave the email address field empty.<span class="code-tag">&lt;/message&gt;</span>
<span class="code-tag">&lt;/validator&gt;</span>
<span class="code-tag">&lt;validator type=<span class="code-quote">"email"</span>&gt;</span>
    <span class="code-tag">&lt;param name=<span class="code-quote">"fieldName"</span>&gt;</span>email_address<span class="code-tag">&lt;/param&gt;</span>
    <span class="code-tag">&lt;message&gt;</span>The email address you entered is not valid.<span class="code-tag">&lt;/message&gt;</span>
<span class="code-tag">&lt;/validator&gt;</span></pre>
</div></div>

<table cellpadding='5' width='85%' cellspacing='8px' class='tipMacro' border="0" align='center'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="icons/emoticons/check.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b class="strong">Hint</b><br />
<p>It is always better to defined field-validator inside a &lt;field&gt; tag instead of using a &lt;validator&gt; tag and supplying fieldName as its param as the xml code itself is clearer (grouping of field is clearer)</p></td></tr></table>

<p>Note that you should only use FieldValidators (<b>not</b> plain Validators) within a &lt;field-validator&gt; block. A plain Validator inside a &lt;field&gt; will not be allowed and would generate error when parsing the xml, as it is not allowed in the defined dtd (xwork-validator-1.0.2.dtd)</p>


<h2><a name="ValidationFramework-Shortcircuitingvalidationchecks"></a>Short-circuiting validation checks</h2>

<p>Beginning with XWork 1.0.1 (bundled with WebWork 2.1), it is possible to short-circuit a stack of validators.  Here is another sample config file containing validation rules from the Xwork test cases:</p>

<div class="code"><div class="codeContent">
<pre class="code-xml">&lt;!DOCTYPE validators PUBLIC <span class="code-quote">"-//OpenSymphony Group//XWork Validator 1.0.2//EN"</span> 
<span class="code-quote">"http://www.opensymphony.com/xwork/xwork-validator-1.0.2.dtd"</span>&gt;
<span class="code-tag">&lt;validators&gt;</span>
    <span class="code-tag"><span class="code-comment">&lt;!-- Field Validators for email field --&gt;</span></span>
    <span class="code-tag">&lt;field name=<span class="code-quote">"email"</span>&gt;</span>
        <span class="code-tag">&lt;field-validator type=<span class="code-quote">"required"</span> short-circuit=<span class="code-quote">"true"</span>&gt;</span>
            <span class="code-tag">&lt;message&gt;</span>You must enter a value for email.<span class="code-tag">&lt;/message&gt;</span>
        <span class="code-tag">&lt;/field-validator&gt;</span>
        <span class="code-tag">&lt;field-validator type=<span class="code-quote">"email"</span> short-circuit=<span class="code-quote">"true"</span>&gt;</span>
            <span class="code-tag">&lt;message&gt;</span>Not a valid e-mail.<span class="code-tag">&lt;/message&gt;</span>
        <span class="code-tag">&lt;/field-validator&gt;</span>
    <span class="code-tag">&lt;/field&gt;</span>
    <span class="code-tag"><span class="code-comment">&lt;!-- Field Validators for email2 field --&gt;</span></span>
    <span class="code-tag">&lt;field name=<span class="code-quote">"email2"</span>&gt;</span>
        <span class="code-tag">&lt;field-validator type=<span class="code-quote">"required"</span>&gt;</span>
            <span class="code-tag">&lt;message&gt;</span>You must enter a value for email2.<span class="code-tag">&lt;/message&gt;</span>
        <span class="code-tag">&lt;/field-validator&gt;</span>
        <span class="code-tag">&lt;field-validator type=<span class="code-quote">"email"</span>&gt;</span>
            <span class="code-tag">&lt;message&gt;</span>Not a valid e-mail2.<span class="code-tag">&lt;/message&gt;</span>
        <span class="code-tag">&lt;/field-validator&gt;</span>
    <span class="code-tag">&lt;/field&gt;</span>
    <span class="code-tag"><span class="code-comment">&lt;!-- Plain Validator 1 --&gt;</span></span>
    <span class="code-tag">&lt;validator type=<span class="code-quote">"expression"</span>&gt;</span>
        <span class="code-tag">&lt;param name=<span class="code-quote">"expression"</span>&gt;</span>email.equals(email2)<span class="code-tag">&lt;/param&gt;</span>
        <span class="code-tag">&lt;message&gt;</span>Email not the same as email2<span class="code-tag">&lt;/message&gt;</span>
    <span class="code-tag">&lt;/validator&gt;</span>
    <span class="code-tag"><span class="code-comment">&lt;!-- Plain Validator 2 --&gt;</span></span>
    <span class="code-tag">&lt;validator type=<span class="code-quote">"expression"</span> short-circuit=<span class="code-quote">"true"</span>&gt;</span>
        <span class="code-tag">&lt;param name=<span class="code-quote">"expression"</span>&gt;</span>email.startsWith('mark')<span class="code-tag">&lt;/param&gt;</span>
        <span class="code-tag">&lt;message&gt;</span>Email does not start with mark<span class="code-tag">&lt;/message&gt;</span>
    <span class="code-tag">&lt;/validator&gt;</span>
<span class="code-tag">&lt;/validators&gt;</span></pre>
</div></div>

<p>Notice that some of the &lt;field-validator&gt; and &lt;validator&gt; elements have the <em>short-circuit</em> attribute set to true. </p>

<p><u><b>short-circuiting and Validator flavors</b></u><br/>
Plain validator takes precedence over field-validator. They get validated first in the order they are defined and then the field-validator in the order they are defined. Failure of a particular validator marked as short-circuit will prevent the evaluation of subsequent validators and an error (action error or field error depending on the type of validator) will be added to the ValidationContext of the object being validated.</p>

<p>In the example above, the actual execution of validator would be as follows:</p>
<ol>
	<li>Plain Validator 1</li>
	<li>Plain Validator 2</li>
	<li>Field Validators for email field</li>
	<li>Field Validators for email2 field</li>
</ol>


<p>Since Field Validator 2 is short-circuited, if its validation failed, it will causes Field validators for email field and Field validators for email2 field to not be validated as well.</p>


<table cellpadding='5' width='85%' cellspacing='8px' class='infoMacro' border="0" align='center'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="icons/emoticons/information.gif" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><b class="strong">Useful Information</b><br />
<p>More complecated validation should probably be done in the validate() method on the action itself (assuming the action implements Validatable interface which ActionSupport already does).</p></td></tr></table>

<p>A plain Validator (non FieldValidator) that gets short-circuited will completely break out of the validation stack &#8211; no other validators will be evaluated and plain validator takes precedence over field validator meaning that they get evaluated in the order they are defined before field validator gets a chance to be evaludated again according to their order defined.</p>

<p><u><b>short-circuiting and Field Validator flavors</b></u><br/>
A FieldValidator that gets short-circuited will only prevent other FieldValidators for the <b>same field</b> from being evaluated.  Note that this "same field" behavior applies regardless of whether the &lt;validator&gt; or &lt;field-validator&gt; syntax was used to declare the validation rule.  By way of example, given this -validation.xml file:</p>

<div class="code"><div class="codeContent">
<pre class="code-xml"><span class="code-tag">&lt;validator type=<span class="code-quote">"required"</span> short-circuit=<span class="code-quote">"true"</span>&gt;</span>
    <span class="code-tag">&lt;param name=<span class="code-quote">"fieldName"</span>&gt;</span>bar<span class="code-tag">&lt;/param&gt;</span>
    <span class="code-tag">&lt;message&gt;</span>You must enter a value for bar.<span class="code-tag">&lt;/message&gt;</span>
<span class="code-tag">&lt;/validator&gt;</span>

<span class="code-tag">&lt;validator type=<span class="code-quote">"expression"</span>&gt;</span>
    <span class="code-tag">&lt;param name=<span class="code-quote">"expression"</span>&gt;</span>foo gt bar<span class="code-tag">&lt;/param&gt;</span>
    <span class="code-tag">&lt;message&gt;</span>foo must be great than bar.<span class="code-tag">&lt;/message&gt;</span>
<span class="code-tag">&lt;/validator&gt;</span></pre>
</div></div>

<p><b>both</b> validators will be run, even if the "required" validator short-circuits.  "required" validators are FieldValidator's and will not short-circuit the plain ExpressionValidator because FieldValidators only short-circuit other checks on that same field.  Since the plain Validator is not field specific, it is not short-circuited.</p>

<p><u><b>How Xwork finds a validator for an action</b></u><br/>
As mentioned above,  the framework will also search up the inheritance tree of the action to find default validations for interfaces and parent classes of the Action.  If you are using the <em>short-circuit</em> attribute and relying on default validators higher up in the inheritance tree, make sure you don't accidentally short-circuit things higher in the tree that you really want!</p>

<p><img class="emoticon" src="./icons/emoticons/warning.gif" height="16" width="16" align="absmiddle" alt="" border="0"/> <b>Upgrade Alert</b>:  The <em>short-circuit</em> attribute was added to the DTD in version 1.0.2.  Your validation files must use version 1.0.2 of the xwork-validation.dtd to validate properly.</p>

                    			    </td>
		    </tr>
	    </table>
    </body>
</html>
