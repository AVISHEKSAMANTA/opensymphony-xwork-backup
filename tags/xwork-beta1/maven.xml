<?xml version="1.0"?>

<project default="java:jar" 
  xmlns:jxr="jxr" 
  xmlns:j="jelly:core" 
  xmlns:deploy="deploy" 
  xmlns:ant="jelly:ant"
  xmlns:maven="jelly:maven">

  <!-- 
    - we want this to happen every time we deploy the site
    -->
  <postGoal name="site:deploy">
    <attainGoal name="deploy-snapshot"/>
  </postGoal>

  <!-- 
    - create a snapshot and automatically deploy it to the maven repository
    -->
  <goal name="deploy-snapshot">
    <maven:snapshot project="${pom}"/>
    <j:set var="maven.final.name" value="${snapshotSignature}"/>
    <ant:echo>Building snapshot JAR: ${maven.final.name}</ant:echo>

    <attainGoal name="jar:jar"/>

    <!--
      - xwork.jar.dir is a custom property defined in project.properties that 
      - indicates which directory on the remote server the snapshot should be 
      - deployed to
      -->
    <echo message="copying to ${maven.username}@${pom.siteAddress}:${xwork.jar.dir}"/>
    <exec dir="${maven.build.dir}" executable="${maven.scp.executable}">
      <arg value="${maven.final.name}.jar"/>
      <arg value="${maven.username}@${pom.siteAddress}:${xwork.jar.dir}"/>
    </exec>
    <exec dir="${maven.build.dir}" executable="${maven.scp.executable}">
      <arg value="${maven.final.name}.jar"/>
      <arg value="${maven.username}@${pom.siteAddress}:${xwork.jar.dir}/xwork-SNAPSHOT.jar"/>
    </exec>
  </goal>
</project>
